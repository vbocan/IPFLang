%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f4f8', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#4a90a4', 'lineColor': '#4a90a4'}}}%%

flowchart TB
    subgraph overview["Monotonicity Verification"]
        direction TB
        
        Input["Fee f, Input x<br/>Domain [min, max]<br/>Expected direction d"]
        
        Sample["Sample other inputs σ₋ₓ<br/>(context sampling)"]
        
        Values["Sample x values V<br/>(20 ordered points)"]
        
        Eval["For each v ∈ sort(V):<br/>Evaluate f(σ₋ₓ[x ↦ v])"]
        
        Check{"Check direction<br/>against d?"}
        
        Violation["Record violation:<br/>(σ₋ₓ, v₁, fee₁, v₂, fee₂)"]
        Pass["Continue to<br/>next value"]
        
        Result["Return (monotonic?, violations)"]
        
        Input --> Sample --> Values --> Eval --> Check
        Check -->|Violates| Violation --> Result
        Check -->|Passes| Pass --> Eval
    end

    subgraph directions["Direction Types"]
        direction TB
        ND["<b>NonDecreasing</b><br/>v₁ < v₂ ⟹ f(v₁) ≤ f(v₂)<br/><i>e.g., claim fees</i>"]
        NI["<b>NonIncreasing</b><br/>v₁ < v₂ ⟹ f(v₁) ≥ f(v₂)<br/><i>e.g., discount fees</i>"]
        SI["<b>StrictlyIncreasing</b><br/>v₁ < v₂ ⟹ f(v₁) < f(v₂)"]
        SD["<b>StrictlyDecreasing</b><br/>v₁ < v₂ ⟹ f(v₁) > f(v₂)"]
    end

    subgraph example["Example: Claim Fee"]
        direction LR
        E1["Claims: 10<br/>Fee: 0"]
        E2["Claims: 20<br/>Fee: 1,325"]
        E3["Claims: 55<br/>Fee: 12,575"]
        
        E1 -->|"✓ increasing"| E2 -->|"✓ increasing"| E3
    end

    overview --> directions
    overview --> example

    style overview fill:#f8f9fa,stroke:#4a90a4,stroke-width:2px
    style directions fill:#e8f4f8,stroke:#4a90a4
    style example fill:#f0f7e6,stroke:#7cb342
    style Violation fill:#ffebee,stroke:#c62828
    style Pass fill:#e8f5e9,stroke:#2e7d32
