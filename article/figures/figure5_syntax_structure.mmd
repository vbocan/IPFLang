%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f4f8', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#4a90a4', 'lineColor': '#4a90a4'}}}%%

flowchart TB
    subgraph program["IPFLang Program Structure"]
        direction TB
        
        V["VERSION Declaration<br/><i>(optional)</i>"]
        G["GROUP Definitions<br/><i>(optional)</i>"]
        I["INPUT Definitions<br/><i>(required)</i>"]
        F["FEE Computations<br/><i>(required)</i>"]
        VF["VERIFY Directives<br/><i>(optional)</i>"]
        R["RETURN Statements<br/><i>(optional)</i>"]
        
        V --> G --> I --> F --> VF --> R
    end

    subgraph inputs["Input Types"]
        direction LR
        LIST["LIST<br/>(single choice)"]
        MULTI["MULTILIST<br/>(multi choice)"]
        NUM["NUMBER<br/>(constrained)"]
        BOOL["BOOLEAN<br/>(yes/no)"]
        DATE["DATE<br/>(temporal)"]
        AMT["AMOUNT<br/>(currency-typed)"]
    end

    subgraph fee["Fee Computation Block"]
        direction TB
        FEE["COMPUTE FEE name"]
        LET["LET var AS expr<br/><i>(local bindings)</i>"]
        CASE["CASE condition AS<br/>&nbsp;&nbsp;YIELD expr<br/>ENDCASE"]
        YIELD["YIELD expr IF cond"]
        END["ENDCOMPUTE"]
        
        FEE --> LET --> CASE --> YIELD --> END
    end

    I --> inputs
    F --> fee

    style program fill:#f8f9fa,stroke:#4a90a4,stroke-width:2px
    style inputs fill:#e8f4f8,stroke:#4a90a4
    style fee fill:#f0f7e6,stroke:#7cb342
    style V fill:#fff5e6,stroke:#ffa726
    style G fill:#fff5e6,stroke:#ffa726
    style I fill:#e8f4f8,stroke:#4a90a4,stroke-width:2px
    style F fill:#e8f4f8,stroke:#4a90a4,stroke-width:2px
    style VF fill:#fff5e6,stroke:#ffa726
    style R fill:#fff5e6,stroke:#ffa726
