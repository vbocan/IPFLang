%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f4f8', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#4a90a4', 'lineColor': '#4a90a4'}}}%%

flowchart TB
    subgraph coverage["PCT National/Regional Phase Coverage"]
        direction TB
        
        subgraph regional["Regional Patent Organizations (4 bases)"]
            direction LR
            EP["<b>European Patent</b><br/>(base_ep.ipf)<br/>38 member states"]
            EA["<b>Eurasian Patent</b><br/>(base_ea.ipf)<br/>9 member states"]
            AP["<b>ARIPO</b><br/>(base_ap.ipf)<br/>19 member states"]
            OA["<b>OAPI</b><br/>(base_oa.ipf)<br/>17 member states"]
        end

        subgraph jurisdictions["118 Jurisdiction Files"]
            direction TB
            
            subgraph standalone["Standalone Jurisdictions"]
                US["PCT-US.ipf<br/>(USPTO)"]
                JP["PCT-JP.ipf<br/>(JPO)"]
                CN["PCT-CN.ipf<br/>(CNIPA)"]
                KR["PCT-KR.ipf<br/>(KIPO)"]
                Others["+ 30 others"]
            end
            
            subgraph composed["Composed Jurisdictions"]
                DE["PCT-DE.ipf<br/>→ base_ep.ipf"]
                FR["PCT-FR.ipf<br/>→ base_ep.ipf"]
                RO["PCT-RO.ipf<br/>→ base_ep.ipf"]
                RU["PCT-RU.ipf<br/>→ base_ea.ipf"]
                More["+ 80 others"]
            end
        end
    end

    subgraph composition["Composition Pattern"]
        direction LR
        Base["Base File<br/>(regional fees)"]
        National["National File<br/>(country-specific)"]
        Final["Final Fee Set<br/>(inherited + overridden)"]
        
        Base --> |"inherits"| Final
        National --> |"extends"| Final
    end

    subgraph stats["Coverage Statistics"]
        direction TB
        S1["<b>Total Files:</b> 118 + 4 bases"]
        S2["<b>Lines of DSL:</b> ~11,800"]
        S3["<b>Validation:</b> Expert-verified<br/>against official PCT schedules"]
    end

    regional --> jurisdictions
    composed --> composition

    style coverage fill:#f8f9fa,stroke:#4a90a4,stroke-width:2px
    style regional fill:#e8f4f8,stroke:#4a90a4
    style jurisdictions fill:#fff,stroke:#999
    style standalone fill:#f0f7e6,stroke:#7cb342
    style composed fill:#fff5e6,stroke:#ffa726
    style composition fill:#e8f4f8,stroke:#4a90a4
    style stats fill:#f5f5f5,stroke:#666
